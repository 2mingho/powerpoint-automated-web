{% extends 'base.html' %}
{% block title %}Panel de AdministraciÃ³n | Data Intel{% endblock %}
{% block content %}
<div class="admin-container">
  <div class="admin-header">
    <h1>âš™ï¸ Panel de AdministraciÃ³n</h1>
    <p class="admin-subtitle">GestiÃ³n de usuarios, roles y actividad del sistema</p>
  </div>

  <!-- Stats Cards -->
  <div class="admin-stats">
    <div class="stat-card">
      <div class="stat-icon">ğŸ‘¥</div>
      <div class="stat-value">{{ total_users }}</div>
      <div class="stat-label">Usuarios Totales</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">âœ…</div>
      <div class="stat-value">{{ active_users }}</div>
      <div class="stat-label">Activos</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ›¡ï¸</div>
      <div class="stat-value">{{ roles_count.admin }}</div>
      <div class="stat-label">Admins</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-value">{{ roles_count.DI }}</div>
      <div class="stat-label">DI</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ“¡</div>
      <div class="stat-value">{{ roles_count.MW }}</div>
      <div class="stat-label">MW</div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="admin-actions-row">
    <a href="{{ url_for('admin.users_list') }}" class="btn blue">ğŸ‘¥ Gestionar Usuarios</a>
    <a href="{{ url_for('admin.user_create') }}" class="btn blue">â• Crear Usuario</a>
    <a href="{{ url_for('admin.activity_log') }}" class="btn light">ğŸ“‹ Ver Actividad</a>
  </div>

  <!-- Recent Activity -->
  <div class="admin-section">
    <h2>ğŸ“‹ Actividad Reciente</h2>
    {% if recent_logs %}
    <table class="admin-table">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Usuario</th>
          <th>AcciÃ³n</th>
          <th>Detalle</th>
        </tr>
      </thead>
      <tbody>
        {% for log in recent_logs %}
        <tr>
          <td>{{ log.timestamp.strftime('%d/%m/%Y %H:%M') if log.timestamp else 'â€”' }}</td>
          <td>{{ log.user.username if log.user else 'Desconocido' }}</td>
          <td><span class="action-badge">{{ log.action }}</span></td>
          <td class="detail-cell">{{ log.detail[:80] }}{{ 'â€¦' if log.detail|length > 80 else '' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <a href="{{ url_for('admin.activity_log') }}" class="btn light" style="margin-top:15px;">Ver toda la actividad â†’</a>
    {% else %}
    <p class="empty-state">No hay actividad registrada aÃºn.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
