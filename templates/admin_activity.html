{% extends 'base.html' %}
{% block title %}Registro de Actividad | Admin{% endblock %}
{% block content %}
<div class="admin-container">
  <div class="admin-header">
    <h1>üìã Registro de Actividad{% if single_user is defined and single_user %} ‚Äî {{ single_user.username }}{% endif %}</h1>
    <a href="{{ url_for('admin.dashboard') }}" class="btn light">‚Üê Panel</a>
  </div>

  <!-- Filters -->
  <div class="admin-filters">
    <form method="GET" action="{{ url_for('admin.activity_log') }}" class="filter-form">
      <select name="user_id" class="filter-select">
        <option value="">Todos los usuarios</option>
        {% for u in users %}
        <option value="{{ u.id }}" {{ 'selected' if user_filter == u.id|string }}>{{ u.username }}</option>
        {% endfor %}
      </select>
      <input type="text" name="action" placeholder="üîç Filtrar por acci√≥n..." value="{{ action_filter }}" class="filter-input">
      <button type="submit" class="btn blue">Filtrar</button>
    </form>
  </div>

  <!-- Activity Table -->
  {% if logs.items %}
  <table class="admin-table">
    <thead>
      <tr>
        <th>Fecha y Hora</th>
        <th>Usuario</th>
        <th>Acci√≥n</th>
        <th>Detalle</th>
        <th>IP</th>
      </tr>
    </thead>
    <tbody>
      {% for log in logs.items %}
      <tr>
        <td class="nowrap">{{ log.timestamp.strftime('%d/%m/%Y %H:%M:%S') if log.timestamp else '‚Äî' }}</td>
        <td>
          {% if log.user %}
            <a href="{{ url_for('admin.user_activity', user_id=log.user_id) }}">{{ log.user.username }}</a>
          {% else %}
            <em>Desconocido</em>
          {% endif %}
        </td>
        <td><span class="action-badge action-{{ log.action.split('_')[0] }}">{{ log.action }}</span></td>
        <td class="detail-cell">{{ log.detail if log.detail else '‚Äî' }}</td>
        <td class="nowrap">{{ log.ip_address or '‚Äî' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="pagination">
    {% if logs.has_prev %}
    <a href="{{ url_for('admin.activity_log', page=logs.prev_num, user_id=user_filter, action=action_filter) }}" class="btn light">‚Üê Anterior</a>
    {% endif %}
    <span class="page-info">P√°gina {{ logs.page }} de {{ logs.pages }} ({{ logs.total }} registros)</span>
    {% if logs.has_next %}
    <a href="{{ url_for('admin.activity_log', page=logs.next_num, user_id=user_filter, action=action_filter) }}" class="btn light">Siguiente ‚Üí</a>
    {% endif %}
  </div>
  {% else %}
  <p class="empty-state">No hay registros de actividad con los filtros seleccionados.</p>
  {% endif %}
</div>
{% endblock %}
